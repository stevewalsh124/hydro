# hydro
## Sensitivity and Uncertainty Analyses for Hydrodynamical Runs

The first thing you can do is pre-process the data using `preprocessing.R`.

These scripts analyze datasets with one of two designs ("`a`" and/or "`c`"); each design has 32 runs, for a current total of up to 64 runs being used for training (for a particular resolution). Additionally, there are hi-resolution (32MPC) and low-resolution (128MPC) versions for each of these runs, making for a grand total of 128 runs. Each design location (input) is 4-dimensional, and the output is functional in nature, representing the galaxy stellar mass function (GSMF). For more details on the background of this data as well as the subsequent modeling done, some details are provided in the fourth chapter of my [dissertation](https://vtechworks.lib.vt.edu/bitstream/handle/10919/115494/Walsh_SA_D_2023.pdf?sequence=1&isAllowed=y).

In order to analyze these data, GPs model different principal components (PCs) of the GSMF. These GPs can have a covariance function which is constructed using the powered exponential, or a BSS-ANOVA covariance function (the `bssanova.R` script is courtesy of Curt Storlie and Brian Reich). After the GP fit for each PC is done, the results can be combined to get predicted GSMFs for unobserved (or held out) input locations. This is done in the `bssanovaHydro.R` file; it has toggles for using the hi- or low-res runs, whether to train on design a, design c, or both (design ac), and what type of predictive design you would like (a or c, full factorial (FF), Latin Hypercube (LHS), uniform, etc). The corresponding `bssanovaHydro.sh` shell script allows you to run the R script for each batch of model runs with the following command:

`for i in $(seq 1 32); do sbatch bssanovaHydro.sh $i; done`.

The `new32_hydro.R` and `new32_reverse.R` scripts trains on design `a` and predicts `c` and vice-versa, respectively. Note, these predictions can be done using the more general `bssanovaHydro.R` script, but the `new32_*` scripts will automatically make some nicer plots showing the held out runs compared to the predictions for GSMF. `eval_hydro.R` evaluates the accuracy of the predictions for the different approaches (powered exponential, BSS-ANOVA (main effects only), BSS-ANOVA (main effects and two-way interactions)). Note, the `hydro_plotting.R` has code for assorted plots that are used in the dissertation and elsewhere. Additionally, leave-one-out cross-validation (LOOCV) predictions can also be done using `LOOCV_hydro.R`. I also looked at how the main effects estimates for the four input parameters changed using LOOCV with `LOOCV_MEs(_eval).R` and `UQ_MEs.R`. 

To understand how some of the BSS-ANOVA decompositions are done, the `bss_toy.R` and `bss_nottoy.R` scripts study how the overall mean, main effect terms, two-way interactions, etc. can all combine to recreate the original data.
